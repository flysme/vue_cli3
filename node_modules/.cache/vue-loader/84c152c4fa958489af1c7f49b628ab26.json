{"remainingRequest":"/Users/moge/dafei/study_project/Vue/saas/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/moge/dafei/study_project/Vue/saas/src/views/Containers/goods/editgoods.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/moge/dafei/study_project/Vue/saas/src/views/Containers/goods/editgoods.vue","mtime":1554270928066},{"path":"/Users/moge/dafei/study_project/Vue/saas/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/moge/dafei/study_project/Vue/saas/node_modules/cache-loader/dist/cjs.js","mtime":1538991184695},{"path":"/Users/moge/dafei/study_project/Vue/saas/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport upLoad from '@/components/upLoad'\nimport UTILS from '@/utils/utils'\nimport { mapState } from 'vuex'\nexport default {\n  name: 'editgoodList',\n  data () {\n    return {\n      userinfo:UTILS.storage.get('userinfo'),\n      products_name:'',\n      products_desc:'',\n      products_image:'',\n      products_unit:'',\n      category_id:'',\n      cats_name:'',\n      sales_price:'',\n      costing_price:'',\n      num:'',\n      skuSttrList:[],\n      sku_unit:['只','瓶','袋','包','箱','盒','条','听','杯','本','把','对','台','克','两','斤','公斤'],\n      exthead:[{k:'num',n:'库存'},{k:'price',n:'零售价'},{k:'cost_price',n:'成本价'}],\n      newtableList:[],\n      headData:[], //sku头部名称\n      details:{}, //详情数据\n      editSkuStatus:false, //编辑sku状态\n    }\n  },\n  props:{\n    product_id:{\n      type: String,\n      default:''\n    }\n  },\n  computed: {\n    ...mapState('product_category',{\n        categorysList: state => state.categorysList\n    }),\n    ...mapState('login',{\n        storeStatus:state => state.storeStatus,\n        currentStore: state => state.currentStore,\n    }),\n    /*最大sku规格设置为三层*/\n    isDisabled () {\n      return this.skuSttrList && this.skuSttrList.length >= 3\n    },\n    /*sku规格信息*/\n    isShowSkuList () {\n      return this.skuSttrList && this.skuSttrList.length >= 1\n    },\n    isEditSku () {\n      console.log(!this.product_id == '' && !this.editSkuStatus,\"!this.product_id == '' && !this.editSkuStatus\")\n      return !this.product_id == '' && !this.editSkuStatus\n    }\n  },\n  watch: {\n  'skuSttrList':{\n      handler (newSkuList,oldSkuList) {\n        let table = [];\n        this.headData = []; //头部显示数据\n        if (newSkuList && !newSkuList.length) this.newtableList = [];\n        if (!oldSkuList || (oldSkuList && !oldSkuList.length))return;\n        oldSkuList.forEach((item,index)=>{\n          table.push(item.value);\n          item.key && this.headData.push({k:`define-${index}`,n:item.key});\n        })\n        this.headData.push(...this.exthead);\n        let newtable = ( table.length && UTILS.createTable(table) ) || [];\n        if (newtable.length) {\n          let skuProps = [0,0,0];\n           let new_t = newtable.map(i =>(i = [...(i.reverse()),...skuProps]))\n           this.newtableList = [];\n           new_t.forEach((current,index)=>{\n             let value = [];\n             this.headData.forEach((item,idx)=>{\n               value.push({\n                 n:item.n, //名称\n                 k:item.k, //属性名\n                 v: current[idx] //属性值\n               })\n             })\n             // 属性值存在时进行更新 || 判断是否大于默认sku属性\n             this.headData.length > 3 && this.$set(this.newtableList,index,value);\n           })\n        }\n        if (this.product_id) this.updateSkuList();\n      },\n      deep: true    //深度监听\n    }\n  },\n  created () {\n    this.init();\n  },\n  methods: {\n    /*初始化页面*/\n    init () {\n      this.getCategorys();\n      let promiseque = [this.getCategorys()];\n      if (this.product_id) {\n        this.editSkuMessage();\n        promiseque.push(this.getProductDetails())\n      }\n      let loading = this.$loading();\n      Promise.all(promiseque).then(res=>{\n        loading.close();\n        if (res.length >=2) {\n          this.resetDetailData(res);\n        }\n      }).catch(()=>{\n        loading.close();\n      });\n    },\n    editSkuMessage () {\n      this.$message('sku只有删除才可重新生成');\n    },\n    /*更新sku规格列表*/\n    updateSkuList () {\n      let skus = this.details.skus;\n      if (!this.newtableList.length)return;\n      this.newtableList.forEach(item=>{\n        let key = '';\n        for (let i=0;i<item.length;i++) {\n          if ( (  (item.length-1) -i ) > 2 ) {\n            key += item[i].v;\n            continue;\n          }\n          if (key=='') return;\n          let currentSkuItem  = skus[key];\n          if (currentSkuItem && currentSkuItem[item[i].k]){\n             item[i].v = currentSkuItem[item[i].k];\n          }\n        }\n      })\n    },\n    uploadsuccess (res) {\n      if (res.data.file) {\n        this.products_image = res.data.file;\n      }\n    },\n    /*处理详情数据*/\n    resetDetailData ([categorys,details]) {\n      this.details = details;\n      this.products_name = details.title;\n      this.products_desc = details.desc;\n      this.products_image = details.img;\n      this.category_id = details.category_id;\n      this.products_unit = details.product_unit;\n      this.cats_name = categorys.filter(item=>(item.category_id == details.category_id))[0].category_name;\n      Object.values(details.skusMap).length && Object.values(details.skusMap).forEach(item=>{\n          this.skuSttrList.push({\n            key:item.name,\n            value:item.skuSpecValueList.map(item=>(item.value))\n          })\n      })\n    },\n    /*获取分类*/\n    getCategorys () {\n      return new Promise((resolve,reject)=>{\n        let data = {\n          store_id:this.userinfo.store_id || this.userinfo.store_info[0]['_id']\n        }\n        this.$store.dispatch('product_category/GET_CATEGORYS',data)\n        .then(res=>{\n          resolve(res);\n        })\n        .catch(()=>{\n          reject();\n        })\n      })\n    },\n    /*获取商品详情*/\n    getProductDetails () {\n      return new Promise((resolve,reject)=>{\n        let data = {\n          product_id:this.product_id\n        }\n        this.$store.dispatch('product/GET_PRODUCT_DETAILS',data)\n        .then(res=>{\n          resolve(res);\n        })\n        .catch(()=>{\n          reject();\n        })\n      });\n    },\n    /*设置sku*/\n    setSku () {\n      if (this.skuSttrList.length >= 3)return\n      this.skuSttrList.push({key:'',  value:['']});\n    },\n    /*设置sku 属性值*/\n    setAttrValue (idx) {\n      if (this.skuSttrList[idx]['key']==''){\n        return this.$message.error('请填写属性名')\n      }\n      this.$set(this.skuSttrList[idx]['value'],this.skuSttrList[idx]['value'].length,'');\n    },\n    /*删除属性值*/\n    delSkuRowVal(p_index,c_index){\n      this.skuSttrList[p_index]['value'].splice(c_index,1);\n      this.$set(this.skuSttrList,p_index,this.skuSttrList[p_index]);\n    },\n    /*删除sku 规格行*/\n    delSkuRow (idx) {\n\n      this.skuSttrList.splice(idx,1);\n      if (!this.skuSttrList.length)this.editSkuStatus = true;\n    },\n    // 计算sku item宽度\n    compuWidth(item) {\n      return `width:calc( 100%  / ${ item.length } )`\n    },\n    selectcates (e) {\n      this.category_id = e;\n    },\n    /*验证规格值是都为空*/\n    checkSkuValue () {\n      let flag = true;\n      this.newtableList.forEach(item=>{\n          item.forEach(currentItem=>{\n              if (flag && currentItem.k==\"num\" && (currentItem.v=='' || currentItem.v<=0)) {\n                flag = 'sku库存不能为空或小于0';\n              }\n              if (currentItem.k==\"price\" && (currentItem.v=='' || currentItem.v<=0)) {\n                flag = 'sku价格不能为空或小于0';\n              }\n          })\n      })\n      return flag;\n    },\n    checkSkuReg (c_index,r_index,value) {\n      console.log(c_index,r_index,value);\n    },\n    // 保存商品信息\n    saveGoodInfo () {\n      if (this.products_name == '') {\n        return this.$message.error('请填写商品名称');\n      }\n      if (this.products_desc == '') {\n        return this.$message.error('请填写商品描述');\n      }\n      if (this.products_image == '') {\n        return this.$message.error('请填写商品主图');\n      }\n      if (this.products_unit == '') {\n        return this.$message.error('请填写库存单位');\n      }\n      if (!this.newtableList.length) {\n        return this.$message.error('请填写sku');\n      }\n      if (this.category_id == '') {\n        return this.$message.error('请填写商品分类');\n      }\n      if (this.checkSkuValue()!=true) {\n        return this.$message.error(this.checkSkuValue());\n      }\n      let params = {\n        products_name: this.products_name,\n        products_desc: this.products_desc,\n        products_image: this.products_image,\n        store_id: this.userinfo.store_id || this.userinfo.store_info[0]['_id'],\n        attributes: this.skuSttrList,\n        products_unit: this.products_unit,\n        category_id: this.category_id,\n        skus: this.newtableList,\n      };\n      let moduleAction = 'product/CREATE_GOODS';\n      if (this.product_id) {\n        params.product_id = this.product_id;\n        moduleAction = 'product/EDIT_GOODS';\n      }\n       this.$store.dispatch(moduleAction,params).then(()=>{\n         this.$message.success('商品发布成功');\n         this.$router.push({name:'main.container.goods.goodsList'});\n      }).catch((res)=>{\n        console.log(res,'res')\n        this.$message.error('商品发布失败');\n      })\n    }\n  },\n  components: {\n    upLoad\n  }\n}\n",{"version":3,"sources":["editgoods.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"editgoods.vue","sourceRoot":"src/views/Containers/goods","sourcesContent":["<template>\n  <div id=\"editgoodList\">\n    <el-row>\n      <div class=\"sys-flex form-nav\">\n        基本信息\n      </div>\n    </el-row>\n    <el-row>\n      <div class=\"sys-flex form-item\">\n        <el-col :span=\"3\">\n          <div class=\"demo-input-suffix\">\n            商品名称:\n          </div>\n        </el-col>\n        <el-col :span=\"6\">\n          <el-input\n            size=\"mini\"\n            placeholder=\"请输入商品名称\"\n            v-model=\"products_name\">\n          </el-input>\n        </el-col>\n      </div>\n    </el-row>\n    <el-row>\n      <div class=\"sys-flex form-item\">\n        <el-col :span=\"3\">\n          <div class=\"demo-input-suffix\">\n            商品描述:\n          </div>\n        </el-col>\n        <el-col :span=\"6\">\n          <el-input\n            size=\"mini\"\n            placeholder=\"请输入商品描述\"\n            v-model=\"products_desc\">\n          </el-input>\n        </el-col>\n      </div>\n    </el-row>\n    <el-row>\n      <div class=\"sys-flex form-item\">\n        <el-col :span=\"3\">\n          <div class=\"demo-input-suffix\">\n            商品主图:\n          </div>\n        </el-col>\n        <el-col :span=\"20\">\n          <upLoad @success=\"uploadsuccess\" :img=\"products_image\"></upLoad>\n        </el-col>\n      </div>\n    </el-row>\n    <el-row>\n      <div class=\"sys-flex form-item\">\n        <el-col :span=\"3\">\n          <div class=\"demo-input-suffix\">\n            分类:\n          </div>\n        </el-col>\n        <el-col :span=\"4\">\n          <el-select v-model=\"cats_name\" placeholder=\"商品分类\" size=\"mini\" @change=\"selectcates\">\n              <el-option :label=\"cateitem.category_name\" :value=\"cateitem.category_id\" :key=\"index\"  v-for=\"(cateitem,index) in categorysList\" ></el-option>\n          </el-select>\n        </el-col>\n        <el-col :span=\"3\">\n          <div class=\"demo-input-suffix cates-tps\" @click=\"$router.push({name:'main.container.goods.goodsCats'})\">\n           去添加分类\n          </div>\n        </el-col>\n      </div>\n    </el-row>\n    <el-row>\n      <div class=\"sys-flex form-item\">\n        <el-col :span=\"3\">\n          <div class=\"demo-input-suffix\">\n            库存单位:\n          </div>\n        </el-col>\n        <el-col :span=\"4\">\n          <el-select v-model=\"products_unit\" placeholder=\"库存单位\" size=\"mini\">\n            <el-option :label=\"item\" :value=\"item\" :key=\"index\"  v-for=\"(item,index) in sku_unit\" ></el-option>\n          </el-select>\n        </el-col>\n      </div>\n    </el-row>\n    <el-row>\n      <div class=\"sys-flex form-nav\">\n        规格信息(sku)\n      </div>\n    </el-row>\n    <el-row>\n      <div class=\"sys-flex form-item\">\n        <el-col :span=\"3\">\n          <div class=\"demo-input-suffix\">\n            设置规格:\n          </div>\n        </el-col>\n        <el-col :span=\"4\">\n          <div class=\"sku-set-main\">\n            <div class=\"set-row sys-flex rel\" v-for=\"(attr,index) in skuSttrList\" :key=\"index\">\n              <div class=\"icon abs\" @click=\"delSkuRow(index)\">\n                <i class=\"el-icon-vue-xianshi_quxiaotianchong\"></i>\n              </div>\n              <el-input\n                width=\"10px\"\n                size=\"mini\"\n                placeholder=\"属性名\"\n                v-model=\"attr.key\"\n                :disabled=\"isEditSku\"\n                >\n              </el-input>\n              <div class=\"attr-n-line\"></div>\n              <div class=\"attr-value-main sys-flex\">\n                 <div class=\"rel\" v-if=\"attr.value.length\" v-for=\"(items,idx) in attr.value\" :key=\"idx\">\n                   <el-input\n                     width=\"10px\"\n                     size=\"mini\"\n                     placeholder=\"属性值\"\n                     autofocus=\"true\"\n                     :disabled=\"attr.key=='' || isEditSku\"\n                     v-model=\"attr.value[idx]\">\n                   </el-input>\n                   <i class=\"el-icon-vue-xianshi_quxiaotianchong abs del-icon\" v-if=\"!isEditSku\" @click=\"delSkuRowVal(index,idx)\"></i>\n                 </div>\n                 <!-- sku属性值最多6级 -->\n                  <div class=\"append-attr f-6\" @click=\"setAttrValue(index)\" v-if=\"!isEditSku && attr.value.length < 6\">\n                      +添加\n                  </div>\n              </div>\n            </div>\n            <div @click=\"setSku\" v-if=\"!isEditSku\">\n              <el-input\n                :disabled=\"isDisabled\"\n                width=\"20px\"\n                size=\"mini\"\n                readonly\n                placeholder=\"添加规格\"\n                >\n              </el-input>\n            </div>\n          </div>\n        </el-col>\n      </div>\n    </el-row>\n    <!-- 规格信息 start -->\n    <el-row v-if=\"isShowSkuList\">\n      <div class=\"sys-flex form-item\">\n        <el-col :span=\"3\">\n          <div class=\"demo-input-suffix\">\n            规格信息:\n          </div>\n        </el-col>\n        <el-col :span=\"4\">\n          <div class=\"sku-table-main\" v-if=\"newtableList.length || headData.length\">\n            <div class=\"sku-table-header sys-flex\">\n                <div class=\"sku-t-th\" :style=\"compuWidth(headData)\" v-for=\"(head,idx) in headData\" :key=\"idx\">\n                    {{head.n}}\n                </div>\n            </div>\n            <div class=\"sku-table-body  sys-flex\" v-for=\"(item,index) in newtableList\" :key=\"index\">\n                <div class=\"sku-t-td\" :style=\"compuWidth(item)\" v-for=\"(current,idx) in item\" :key=\"idx\" >\n                    <el-input type=\"number\" min=\"1\" v-if=\"current.k=='num' || current.k=='price' || current.k=='cost_price'\" @blur=\"checkSkuReg(index,idx,current.v)\" v-model=\"current.v\" :disabled=\"isEditSku\"></el-input>\n                    <span v-else>{{current.v}}</span>\n                </div>\n            </div>\n          </div>\n        </el-col>\n      </div>\n    </el-row>\n    <el-row>\n      <el-col :span=\"24\">\n        <div class=\"btn-save\" :data='isEditSku'>\n           <el-button type=\"primary\"  size=\"mini\" :disabled=\"!storeStatus.canhandle||isEditSku\" @click=\"saveGoodInfo\">保存</el-button>\n        </div>\n      </el-col>\n    </el-row>\n  </div>\n</template>\n<script>\nimport upLoad from '@/components/upLoad'\nimport UTILS from '@/utils/utils'\nimport { mapState } from 'vuex'\nexport default {\n  name: 'editgoodList',\n  data () {\n    return {\n      userinfo:UTILS.storage.get('userinfo'),\n      products_name:'',\n      products_desc:'',\n      products_image:'',\n      products_unit:'',\n      category_id:'',\n      cats_name:'',\n      sales_price:'',\n      costing_price:'',\n      num:'',\n      skuSttrList:[],\n      sku_unit:['只','瓶','袋','包','箱','盒','条','听','杯','本','把','对','台','克','两','斤','公斤'],\n      exthead:[{k:'num',n:'库存'},{k:'price',n:'零售价'},{k:'cost_price',n:'成本价'}],\n      newtableList:[],\n      headData:[], //sku头部名称\n      details:{}, //详情数据\n      editSkuStatus:false, //编辑sku状态\n    }\n  },\n  props:{\n    product_id:{\n      type: String,\n      default:''\n    }\n  },\n  computed: {\n    ...mapState('product_category',{\n        categorysList: state => state.categorysList\n    }),\n    ...mapState('login',{\n        storeStatus:state => state.storeStatus,\n        currentStore: state => state.currentStore,\n    }),\n    /*最大sku规格设置为三层*/\n    isDisabled () {\n      return this.skuSttrList && this.skuSttrList.length >= 3\n    },\n    /*sku规格信息*/\n    isShowSkuList () {\n      return this.skuSttrList && this.skuSttrList.length >= 1\n    },\n    isEditSku () {\n      console.log(!this.product_id == '' && !this.editSkuStatus,\"!this.product_id == '' && !this.editSkuStatus\")\n      return !this.product_id == '' && !this.editSkuStatus\n    }\n  },\n  watch: {\n  'skuSttrList':{\n      handler (newSkuList,oldSkuList) {\n        let table = [];\n        this.headData = []; //头部显示数据\n        if (newSkuList && !newSkuList.length) this.newtableList = [];\n        if (!oldSkuList || (oldSkuList && !oldSkuList.length))return;\n        oldSkuList.forEach((item,index)=>{\n          table.push(item.value);\n          item.key && this.headData.push({k:`define-${index}`,n:item.key});\n        })\n        this.headData.push(...this.exthead);\n        let newtable = ( table.length && UTILS.createTable(table) ) || [];\n        if (newtable.length) {\n          let skuProps = [0,0,0];\n           let new_t = newtable.map(i =>(i = [...(i.reverse()),...skuProps]))\n           this.newtableList = [];\n           new_t.forEach((current,index)=>{\n             let value = [];\n             this.headData.forEach((item,idx)=>{\n               value.push({\n                 n:item.n, //名称\n                 k:item.k, //属性名\n                 v: current[idx] //属性值\n               })\n             })\n             // 属性值存在时进行更新 || 判断是否大于默认sku属性\n             this.headData.length > 3 && this.$set(this.newtableList,index,value);\n           })\n        }\n        if (this.product_id) this.updateSkuList();\n      },\n      deep: true    //深度监听\n    }\n  },\n  created () {\n    this.init();\n  },\n  methods: {\n    /*初始化页面*/\n    init () {\n      this.getCategorys();\n      let promiseque = [this.getCategorys()];\n      if (this.product_id) {\n        this.editSkuMessage();\n        promiseque.push(this.getProductDetails())\n      }\n      let loading = this.$loading();\n      Promise.all(promiseque).then(res=>{\n        loading.close();\n        if (res.length >=2) {\n          this.resetDetailData(res);\n        }\n      }).catch(()=>{\n        loading.close();\n      });\n    },\n    editSkuMessage () {\n      this.$message('sku只有删除才可重新生成');\n    },\n    /*更新sku规格列表*/\n    updateSkuList () {\n      let skus = this.details.skus;\n      if (!this.newtableList.length)return;\n      this.newtableList.forEach(item=>{\n        let key = '';\n        for (let i=0;i<item.length;i++) {\n          if ( (  (item.length-1) -i ) > 2 ) {\n            key += item[i].v;\n            continue;\n          }\n          if (key=='') return;\n          let currentSkuItem  = skus[key];\n          if (currentSkuItem && currentSkuItem[item[i].k]){\n             item[i].v = currentSkuItem[item[i].k];\n          }\n        }\n      })\n    },\n    uploadsuccess (res) {\n      if (res.data.file) {\n        this.products_image = res.data.file;\n      }\n    },\n    /*处理详情数据*/\n    resetDetailData ([categorys,details]) {\n      this.details = details;\n      this.products_name = details.title;\n      this.products_desc = details.desc;\n      this.products_image = details.img;\n      this.category_id = details.category_id;\n      this.products_unit = details.product_unit;\n      this.cats_name = categorys.filter(item=>(item.category_id == details.category_id))[0].category_name;\n      Object.values(details.skusMap).length && Object.values(details.skusMap).forEach(item=>{\n          this.skuSttrList.push({\n            key:item.name,\n            value:item.skuSpecValueList.map(item=>(item.value))\n          })\n      })\n    },\n    /*获取分类*/\n    getCategorys () {\n      return new Promise((resolve,reject)=>{\n        let data = {\n          store_id:this.userinfo.store_id || this.userinfo.store_info[0]['_id']\n        }\n        this.$store.dispatch('product_category/GET_CATEGORYS',data)\n        .then(res=>{\n          resolve(res);\n        })\n        .catch(()=>{\n          reject();\n        })\n      })\n    },\n    /*获取商品详情*/\n    getProductDetails () {\n      return new Promise((resolve,reject)=>{\n        let data = {\n          product_id:this.product_id\n        }\n        this.$store.dispatch('product/GET_PRODUCT_DETAILS',data)\n        .then(res=>{\n          resolve(res);\n        })\n        .catch(()=>{\n          reject();\n        })\n      });\n    },\n    /*设置sku*/\n    setSku () {\n      if (this.skuSttrList.length >= 3)return\n      this.skuSttrList.push({key:'',  value:['']});\n    },\n    /*设置sku 属性值*/\n    setAttrValue (idx) {\n      if (this.skuSttrList[idx]['key']==''){\n        return this.$message.error('请填写属性名')\n      }\n      this.$set(this.skuSttrList[idx]['value'],this.skuSttrList[idx]['value'].length,'');\n    },\n    /*删除属性值*/\n    delSkuRowVal(p_index,c_index){\n      this.skuSttrList[p_index]['value'].splice(c_index,1);\n      this.$set(this.skuSttrList,p_index,this.skuSttrList[p_index]);\n    },\n    /*删除sku 规格行*/\n    delSkuRow (idx) {\n\n      this.skuSttrList.splice(idx,1);\n      if (!this.skuSttrList.length)this.editSkuStatus = true;\n    },\n    // 计算sku item宽度\n    compuWidth(item) {\n      return `width:calc( 100%  / ${ item.length } )`\n    },\n    selectcates (e) {\n      this.category_id = e;\n    },\n    /*验证规格值是都为空*/\n    checkSkuValue () {\n      let flag = true;\n      this.newtableList.forEach(item=>{\n          item.forEach(currentItem=>{\n              if (flag && currentItem.k==\"num\" && (currentItem.v=='' || currentItem.v<=0)) {\n                flag = 'sku库存不能为空或小于0';\n              }\n              if (currentItem.k==\"price\" && (currentItem.v=='' || currentItem.v<=0)) {\n                flag = 'sku价格不能为空或小于0';\n              }\n          })\n      })\n      return flag;\n    },\n    checkSkuReg (c_index,r_index,value) {\n      console.log(c_index,r_index,value);\n    },\n    // 保存商品信息\n    saveGoodInfo () {\n      if (this.products_name == '') {\n        return this.$message.error('请填写商品名称');\n      }\n      if (this.products_desc == '') {\n        return this.$message.error('请填写商品描述');\n      }\n      if (this.products_image == '') {\n        return this.$message.error('请填写商品主图');\n      }\n      if (this.products_unit == '') {\n        return this.$message.error('请填写库存单位');\n      }\n      if (!this.newtableList.length) {\n        return this.$message.error('请填写sku');\n      }\n      if (this.category_id == '') {\n        return this.$message.error('请填写商品分类');\n      }\n      if (this.checkSkuValue()!=true) {\n        return this.$message.error(this.checkSkuValue());\n      }\n      let params = {\n        products_name: this.products_name,\n        products_desc: this.products_desc,\n        products_image: this.products_image,\n        store_id: this.userinfo.store_id || this.userinfo.store_info[0]['_id'],\n        attributes: this.skuSttrList,\n        products_unit: this.products_unit,\n        category_id: this.category_id,\n        skus: this.newtableList,\n      };\n      let moduleAction = 'product/CREATE_GOODS';\n      if (this.product_id) {\n        params.product_id = this.product_id;\n        moduleAction = 'product/EDIT_GOODS';\n      }\n       this.$store.dispatch(moduleAction,params).then(()=>{\n         this.$message.success('商品发布成功');\n         this.$router.push({name:'main.container.goods.goodsList'});\n      }).catch((res)=>{\n        console.log(res,'res')\n        this.$message.error('商品发布失败');\n      })\n    }\n  },\n  components: {\n    upLoad\n  }\n}\n</script>\n<style lang=\"scss\">\n  #editgoodList{\n    width: 100%;\n    height: 100%;\n    background-color: #FFF;\n    .form-nav{\n      border-bottom: 1px solid #efefef;\n      font-weight: 500;\n      margin:10px;\n      padding:10px;\n      box-sizing: border-box;\n    }\n    .form-item{\n      padding:15px 15px 15px 25px;\n      align-items: center;\n      .demo-input-suffix{\n        font-size: 13px;\n\n      }\n      .cates-tps{\n        color: #38f;\n        font-size: 10px;\n        padding-left: 5px;\n        cursor: pointer;\n      }\n      .el-input{\n        input{\n          border-radius: 0;\n        }\n      }\n      .sku-set-main{\n        width: 400px;\n        min-height: 50px;\n        padding:0 0 0 20px;\n        line-height: 50px;\n        box-sizing: border-box;\n        border:1px solid #efefef;\n        .el-input{\n          input{\n            width: 100px;\n            cursor: pointer;\n            text-align: center;\n          }\n        }\n        .set-row{\n          width: 80%;\n          flex-direction: column;\n          align-items: flex-start;\n          border:1px solid  #efefef;\n          margin:10px;\n          padding:10px;\n          .icon{\n            right: -7px;\n            line-height: 1;\n            top:-7px;\n            cursor: pointer;\n          }\n          .el-input{\n            width: 70px;\n            input{\n              width: 70px;\n            }\n          }\n          .attr-n-line{\n            width: 100%;\n            border-bottom: 1px solid #efefef;\n            margin:10px 0;\n          }\n           .attr-value-main{\n             line-height: 1;\n             align-items: center;\n             flex-wrap: wrap;\n             div{\n               margin:3px 3px 3px 0;\n               .del-icon{\n                 top: -5px;\n                 right: -1px;\n               }\n             }\n             .el-input{\n               input{\n                 width: 70px;\n               }\n             }\n           }\n        }\n      }\n      .sku-table-main{\n        width: 600px;\n        border:1px solid #efefef;\n        .sku-table-header{\n          height: 30px;\n          align-items: center;\n          justify-content: space-around;\n          background-color: #efefef;\n          font-size: 14px;\n          padding:0 5px;\n          line-height: 40px;\n          .sku-t-th{\n            line-height: 1;\n          }\n        }\n        .sku-table-body{\n          padding:0 5px;\n          height: 40px;\n          align-items: center;\n          justify-content: space-around;\n          border:1px solid #efefef;\n          .sku-t-td{\n            flex:1;\n            text-align: center;\n            height: 25px;\n            font-size: 13px;\n            border-right: 1px solid #efefef;\n            &:last-child{\n                border-right:none;\n            }\n            .el-input{\n              height: 25px;\n              input{\n                border-radius: 0;\n                height: 25px;\n                text-align: center;\n                width: 100px!important;\n              }\n            }\n          }\n        }\n      }\n    }\n    .btn-save{\n      margin:10px auto;\n\n    }\n  }\n</style>\n"]}]}