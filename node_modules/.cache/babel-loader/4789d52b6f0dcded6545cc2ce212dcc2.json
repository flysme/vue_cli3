{"remainingRequest":"/Users/moge/dafei/study_project/Vue/test-cli3/node_modules/thread-loader/dist/cjs.js!/Users/moge/dafei/study_project/Vue/test-cli3/node_modules/babel-loader/lib/index.js!/Users/moge/dafei/study_project/Vue/test-cli3/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/moge/dafei/study_project/Vue/test-cli3/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/moge/dafei/study_project/Vue/test-cli3/src/views/Containers/goods/editgoods.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/moge/dafei/study_project/Vue/test-cli3/src/views/Containers/goods/editgoods.vue","mtime":1550125045323},{"path":"/Users/moge/dafei/study_project/Vue/test-cli3/node_modules/cache-loader/dist/cjs.js","mtime":1538991184695},{"path":"/Users/moge/dafei/study_project/Vue/test-cli3/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/moge/dafei/study_project/Vue/test-cli3/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/moge/dafei/study_project/Vue/test-cli3/node_modules/cache-loader/dist/cjs.js","mtime":1538991184695},{"path":"/Users/moge/dafei/study_project/Vue/test-cli3/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es7.object.values\";\nimport _slicedToArray from \"/Users/moge/dafei/study_project/Vue/test-cli3/node_modules/@babel/runtime/helpers/builtin/es6/slicedToArray\";\nimport _toConsumableArray from \"/Users/moge/dafei/study_project/Vue/test-cli3/node_modules/@babel/runtime/helpers/builtin/es6/toConsumableArray\";\nimport \"core-js/modules/web.dom.iterable\";\nimport _objectSpread from \"/Users/moge/dafei/study_project/Vue/test-cli3/node_modules/@babel/runtime/helpers/builtin/es6/objectSpread\";\nimport \"core-js/modules/es6.array.iterator\";\nimport \"core-js/modules/es6.promise\";\nimport \"core-js/modules/es7.promise.finally\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport upLoad from '@/components/upLoad';\nimport UTILS from '@/utils/utils';\nimport { mapState } from 'vuex';\nexport default {\n  name: 'editgoodList',\n  data: function data() {\n    return {\n      userinfo: UTILS.storage.get('userinfo'),\n      products_name: '',\n      products_desc: '',\n      products_image: '',\n      products_unit: '',\n      category_id: '',\n      cats_name: '',\n      sales_price: '',\n      costing_price: '',\n      num: '',\n      skuSttrList: [],\n      sku_unit: ['只', '瓶', '袋', '包', '箱', '盒', '条', '听', '杯', '本', '把', '对', '台', '克', '两', '斤', '公斤'],\n      exthead: [{\n        k: 'num',\n        n: '库存'\n      }, {\n        k: 'price',\n        n: '零售价'\n      }],\n      newtableList: [],\n      headData: [],\n      //sku头部名称\n      details: {} //详情数据\n\n    };\n  },\n  props: {\n    product_id: {\n      type: String,\n      default: ''\n    }\n  },\n  computed: _objectSpread({}, mapState('product_category', {\n    categorysList: function categorysList(state) {\n      return state.categorysList;\n    }\n  }), mapState('login', {\n    storeStatus: function storeStatus(state) {\n      return state.storeStatus;\n    },\n    currentStore: function currentStore(state) {\n      return state.currentStore;\n    }\n  }), {\n    /*最大sku规格设置为三层*/\n    isDisabled: function isDisabled() {\n      return this.skuSttrList && this.skuSttrList.length >= 3;\n    },\n\n    /*sku规格信息*/\n    isShowSkuList: function isShowSkuList() {\n      return this.skuSttrList && this.skuSttrList.length >= 1;\n    }\n  }),\n  watch: {\n    'skuSttrList': {\n      handler: function handler(newSkuList, oldSkuList) {\n        var _this = this,\n            _this$headData;\n\n        var table = [];\n        this.headData = [];\n\n        if (newSkuList && !newSkuList.length) {\n          this.newtableList = [];\n        }\n\n        if (!oldSkuList || oldSkuList && !oldSkuList.length) return;\n        oldSkuList.forEach(function (item, index) {\n          table.push(item.value);\n          item.key && _this.headData.push({\n            k: \"define-\".concat(index),\n            n: item.key\n          });\n        });\n\n        (_this$headData = this.headData).push.apply(_this$headData, _toConsumableArray(this.exthead));\n\n        var newtable = table.length && UTILS.createTable(table) || [];\n\n        if (newtable.length) {\n          var ev = [0, 0];\n          var new_t = newtable.map(function (i) {\n            return i = _toConsumableArray(i.reverse()).concat(ev);\n          });\n          this.newtableList = [];\n          new_t.forEach(function (current, index) {\n            var value = [];\n\n            _this.headData.forEach(function (item, idx) {\n              value.push({\n                n: item.n,\n                //名称\n                k: item.k,\n                //属性名\n                v: current[idx] //属性值\n\n              });\n            }); // 属性值存在时进行更新\n\n\n            _this.$set(_this.newtableList, index, value);\n          });\n        }\n\n        if (this.product_id) {\n          this.updateSkuList();\n        }\n      },\n      deep: true //深度监听\n\n    }\n  },\n  created: function created() {\n    this.init();\n  },\n  methods: {\n    /*初始化页面*/\n    init: function init() {\n      var _this2 = this;\n\n      this.getCategorys();\n      var promiseque = [this.getCategorys()];\n\n      if (this.product_id) {\n        promiseque.push(this.getProductDetails());\n      }\n\n      var loading = this.$loading();\n      Promise.all(promiseque).then(function (res) {\n        loading.close();\n\n        if (res.length >= 2) {\n          _this2.resetDetailData(res);\n        }\n      }).catch(function () {\n        loading.close();\n      });\n    },\n\n    /*更新sku规格列表*/\n    updateSkuList: function updateSkuList() {\n      var skus = this.details.skus;\n      if (!this.newtableList.length) return;\n      this.newtableList.forEach(function (item) {\n        var key = '';\n\n        for (var i = 0; i < item.length; i++) {\n          if (item.length - 1 - i > 1) {\n            key += item[i].v;\n            continue;\n          }\n\n          if (key == '') return;\n          var currentSkuItem = skus[key];\n\n          if (item[i].k == \"num\" && currentSkuItem && currentSkuItem.num) {\n            item[i].v = currentSkuItem.num;\n          }\n\n          if (item[i].k == \"price\" && currentSkuItem && currentSkuItem.price) {\n            item[i].v = currentSkuItem.price;\n          }\n        }\n      });\n    },\n    uploadsuccess: function uploadsuccess(res) {\n      if (res.data.file) {\n        this.products_image = res.data.file;\n      }\n\n      console.log(res);\n    },\n\n    /*处理详情数据*/\n    resetDetailData: function resetDetailData(_ref) {\n      var _this3 = this;\n\n      var _ref2 = _slicedToArray(_ref, 2),\n          categorys = _ref2[0],\n          details = _ref2[1];\n\n      this.details = details;\n      this.products_name = details.title;\n      this.products_desc = details.desc;\n      this.products_image = details.img;\n      this.category_id = details.category_id;\n      this.products_unit = details.product_unit;\n      this.cats_name = categorys.filter(function (item) {\n        return item.category_id == details.category_id;\n      })[0].category_name;\n      Object.values(details.skusMap).length && Object.values(details.skusMap).forEach(function (item) {\n        _this3.skuSttrList.push({\n          key: item.name,\n          value: item.skuSpecValueList.map(function (item) {\n            return item.value;\n          })\n        });\n      });\n    },\n\n    /*获取分类*/\n    getCategorys: function getCategorys() {\n      var _this4 = this;\n\n      return new Promise(function (resolve, reject) {\n        var data = {\n          store_id: _this4.userinfo.store_id || _this4.userinfo.store_info[0]['_id']\n        };\n\n        _this4.$store.dispatch('product_category/GET_CATEGORYS', data).then(function (res) {\n          resolve(res);\n        }).catch(function () {\n          reject();\n        });\n      });\n    },\n\n    /*获取商品详情*/\n    getProductDetails: function getProductDetails() {\n      var _this5 = this;\n\n      return new Promise(function (resolve, reject) {\n        var data = {\n          product_id: _this5.product_id\n        };\n\n        _this5.$store.dispatch('product/GET_PRODUCT_DETAILS', data).then(function (res) {\n          resolve(res);\n        }).catch(function () {\n          reject();\n        });\n      });\n    },\n\n    /*设置sku*/\n    setSku: function setSku() {\n      if (this.skuSttrList.length >= 3) return;\n      this.skuSttrList.push({\n        key: '',\n        value: ['']\n      });\n    },\n\n    /*设置sku 属性值*/\n    setAttrValue: function setAttrValue(idx) {\n      if (this.skuSttrList[idx]['key'] == '') {\n        return this.$message.error('请填写属性名');\n      }\n\n      this.$set(this.skuSttrList[idx]['value'], this.skuSttrList[idx]['value'].length, '');\n    },\n\n    /*删除属性值*/\n    delSkuRowVal: function delSkuRowVal(p_index, c_index) {\n      this.skuSttrList[p_index]['value'].splice(c_index, 1);\n      this.$set(this.skuSttrList, p_index, this.skuSttrList[p_index]);\n    },\n\n    /*删除sku 规格行*/\n    delSkuRow: function delSkuRow(idx) {\n      this.skuSttrList.splice(idx, 1);\n    },\n    // 计算sku item宽度\n    compuWidth: function compuWidth(item) {\n      return \"width:calc( 100%  / \".concat(item.length, \" )\");\n    },\n    selectcates: function selectcates(e) {\n      this.category_id = e;\n    },\n\n    /*验证规格值是都为空*/\n    checkSkuValue: function checkSkuValue() {\n      var flag = true;\n      console.log(this.newtableList, 'this.newtableList');\n      this.newtableList.forEach(function (item) {\n        item.forEach(function (currentItem) {\n          if (flag && currentItem.k == \"num\" && (currentItem.v == '' || currentItem.v <= 0)) {\n            flag = 'sku库存不能为空或小于0';\n          }\n\n          if (currentItem.k == \"price\" && (currentItem.v == '' || currentItem.v <= 0)) {\n            flag = 'sku价格不能为空或小于0';\n          }\n        });\n      });\n      return flag;\n    },\n    checkSkuReg: function checkSkuReg(c_index, r_index, value) {\n      console.log(c_index, r_index, value);\n    },\n    // 保存商品信息\n    saveGoodInfo: function saveGoodInfo() {\n      var _this6 = this;\n\n      if (this.products_name == '') {\n        return this.$message.error('请填写商品名称');\n      }\n\n      if (this.products_desc == '') {\n        return this.$message.error('请填写商品描述');\n      } // if (this.products_image == '') {\n      //   return this.$message.error('请填写商品主图');\n      // }\n\n\n      if (this.products_unit == '') {\n        return this.$message.error('请填写库存单位');\n      }\n\n      if (!this.newtableList.length) {\n        return this.$message.error('请填写sku');\n      }\n\n      if (this.category_id == '') {\n        return this.$message.error('请填写商品分类');\n      }\n\n      if (this.checkSkuValue() != true) {\n        return this.$message.error(this.checkSkuValue());\n      }\n\n      var params = {\n        products_name: this.products_name,\n        products_desc: this.products_desc,\n        products_image: this.products_image,\n        store_id: this.userinfo.store_id || this.userinfo.store_info[0]['_id'],\n        attributes: this.skuSttrList,\n        products_unit: this.products_unit,\n        category_id: this.category_id,\n        skus: this.newtableList\n      };\n      var moduleAction = 'product/CREATE_GOODS';\n\n      if (this.product_id) {\n        params.product_id = this.product_id;\n        moduleAction = 'product/EDIT_GOODS';\n      }\n\n      this.$store.dispatch(moduleAction, params).then(function () {\n        _this6.$message.success('商品发布成功');\n\n        _this6.$router.push({\n          name: 'main.container.goods.goodsList'\n        });\n      }).catch(function (res) {\n        console.log(res, 'res');\n\n        _this6.$message.error('商品发布失败');\n      });\n    }\n  },\n  components: {\n    upLoad: upLoad\n  }\n};",{"version":3,"sources":["editgoods.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div id=\"editgoodList\">\n    <el-row>\n      <div class=\"sys-flex form-nav\">\n        基本信息\n      </div>\n    </el-row>\n    <el-row>\n      <div class=\"sys-flex form-item\">\n        <el-col :span=\"3\">\n          <div class=\"demo-input-suffix\">\n            商品名称:\n          </div>\n        </el-col>\n        <el-col :span=\"6\">\n          <el-input\n            size=\"mini\"\n            placeholder=\"请输入商品名称\"\n            v-model=\"products_name\">\n          </el-input>\n        </el-col>\n      </div>\n    </el-row>\n    <el-row>\n      <div class=\"sys-flex form-item\">\n        <el-col :span=\"3\">\n          <div class=\"demo-input-suffix\">\n            商品描述:\n          </div>\n        </el-col>\n        <el-col :span=\"6\">\n          <el-input\n            size=\"mini\"\n            placeholder=\"请输入商品描述\"\n            v-model=\"products_desc\">\n          </el-input>\n        </el-col>\n      </div>\n    </el-row>\n    <el-row>\n      <div class=\"sys-flex form-item\">\n        <el-col :span=\"3\">\n          <div class=\"demo-input-suffix\">\n            商品主图:\n          </div>\n        </el-col>\n        <el-col :span=\"20\">\n          <upLoad @success=\"uploadsuccess\" :img=\"products_image\"></upLoad>\n        </el-col>\n      </div>\n    </el-row>\n    <el-row>\n      <div class=\"sys-flex form-item\">\n        <el-col :span=\"3\">\n          <div class=\"demo-input-suffix\">\n            分类:\n          </div>\n        </el-col>\n        <el-col :span=\"4\">\n          <el-select v-model=\"cats_name\" placeholder=\"商品分类\" size=\"mini\" @change=\"selectcates\">\n              <el-option :label=\"cateitem.category_name\" :value=\"cateitem.category_id\" :key=\"index\"  v-for=\"(cateitem,index) in categorysList\" ></el-option>\n          </el-select>\n        </el-col>\n        <el-col :span=\"3\">\n          <div class=\"demo-input-suffix cates-tps\" @click=\"$router.push({name:'main.container.goods.goodsCats'})\">\n           去添加分类\n          </div>\n        </el-col>\n      </div>\n    </el-row>\n    <el-row>\n      <div class=\"sys-flex form-item\">\n        <el-col :span=\"3\">\n          <div class=\"demo-input-suffix\">\n            库存单位:\n          </div>\n        </el-col>\n        <el-col :span=\"4\">\n          <el-select v-model=\"products_unit\" placeholder=\"库存单位\" size=\"mini\">\n            <el-option :label=\"item\" :value=\"item\" :key=\"index\"  v-for=\"(item,index) in sku_unit\" ></el-option>\n          </el-select>\n        </el-col>\n      </div>\n    </el-row>\n    <el-row>\n      <div class=\"sys-flex form-nav\">\n        规格信息(sku)\n      </div>\n    </el-row>\n    <el-row>\n      <div class=\"sys-flex form-item\">\n        <el-col :span=\"3\">\n          <div class=\"demo-input-suffix\">\n            设置规格:\n          </div>\n        </el-col>\n        <el-col :span=\"4\">\n          <div class=\"sku-set-main\">\n            <div class=\"set-row sys-flex rel\" v-for=\"(attr,index) in skuSttrList\" :key=\"index\">\n              <div class=\"icon abs\" @click=\"delSkuRow(index)\">\n                <i class=\"el-icon-vue-xianshi_quxiaotianchong\"></i>\n              </div>\n              <el-input\n                width=\"10px\"\n                size=\"mini\"\n                placeholder=\"属性名\"\n                v-model=\"attr.key\"\n                >\n              </el-input>\n              <div class=\"attr-n-line\"></div>\n              <div class=\"attr-value-main sys-flex\">\n                 <div class=\"rel\"  v-if=\"attr.value.length\" v-for=\"(items,idx) in attr.value\" :key=\"idx\">\n                   <el-input\n                     width=\"10px\"\n                     size=\"mini\"\n                     placeholder=\"属性值\"\n                     autofocus=\"true\"\n                     :disabled=\"attr.key==''\"\n                     v-model=\"attr.value[idx]\">\n                   </el-input>\n                   <i class=\"el-icon-vue-xianshi_quxiaotianchong abs del-icon\" @click=\"delSkuRowVal(index,idx)\"></i>\n                 </div>\n                  <div class=\"append-attr f-6\" @click=\"setAttrValue(index)\">\n                      +添加\n                  </div>\n              </div>\n            </div>\n            <div @click=\"setSku\">\n              <el-input\n                :disabled=\"isDisabled\"\n                width=\"20px\"\n                size=\"mini\"\n                readonly\n                placeholder=\"添加规格\"\n                >\n              </el-input>\n            </div>\n          </div>\n        </el-col>\n      </div>\n    </el-row>\n    <!-- 规格信息 start -->\n    <el-row v-if=\"isShowSkuList\">\n      <div class=\"sys-flex form-item\">\n        <el-col :span=\"3\">\n          <div class=\"demo-input-suffix\">\n            规格信息:\n          </div>\n        </el-col>\n        <el-col :span=\"4\">\n          <div class=\"sku-table-main\" v-if=\"newtableList.length || headData.length\">\n            <div class=\"sku-table-header sys-flex\">\n                <div class=\"sku-t-th\" :style=\"compuWidth(headData)\" v-for=\"(head,idx) in headData\" :key=\"idx\">\n                    {{head.n}}\n                </div>\n            </div>\n            <div class=\"sku-table-body  sys-flex\" v-for=\"(item,index) in newtableList\" :key=\"index\">\n                <div class=\"sku-t-td\" :style=\"compuWidth(item)\" v-for=\"(current,idx) in item\" :key=\"idx\" >\n                    <el-input type=\"number\" min=\"1\" v-if=\"current.k=='num' || current.k=='price'\" @blur=\"checkSkuReg(index,idx,current.v)\" v-model=\"current.v\"></el-input>\n                    <span v-else>{{current.v}}</span>\n                </div>\n            </div>\n          </div>\n        </el-col>\n      </div>\n    </el-row>\n    <el-row>\n      <el-col :span=\"24\">\n        <div class=\"btn-save\">\n           <el-button type=\"primary\"  size=\"mini\" :disabled=\"!storeStatus.canhandle\" @click=\"saveGoodInfo\">保存</el-button>\n        </div>\n      </el-col>\n    </el-row>\n  </div>\n</template>\n<script>\nimport upLoad from '@/components/upLoad'\nimport UTILS from '@/utils/utils'\nimport { mapState } from 'vuex'\nexport default {\n  name: 'editgoodList',\n  data () {\n    return {\n      userinfo:UTILS.storage.get('userinfo'),\n      products_name:'',\n      products_desc:'',\n      products_image:'',\n      products_unit:'',\n      category_id:'',\n      cats_name:'',\n      sales_price:'',\n      costing_price:'',\n      num:'',\n      skuSttrList:[],\n      sku_unit:['只','瓶','袋','包','箱','盒','条','听','杯','本','把','对','台','克','两','斤','公斤'],\n      exthead:[{k:'num',n:'库存'},{k:'price',n:'零售价'}],\n      newtableList:[],\n      headData:[], //sku头部名称\n      details:{}, //详情数据\n    }\n  },\n  props:{\n    product_id:{\n      type: String,\n      default:''\n    }\n  },\n  computed: {\n    ...mapState('product_category',{\n        categorysList: state => state.categorysList\n    }),\n    ...mapState('login',{\n        storeStatus:state => state.storeStatus,\n        currentStore: state => state.currentStore\n    }),\n    /*最大sku规格设置为三层*/\n    isDisabled () {\n      return this.skuSttrList && this.skuSttrList.length >= 3\n    },\n    /*sku规格信息*/\n    isShowSkuList () {\n      return this.skuSttrList && this.skuSttrList.length >= 1\n    },\n  },\n  watch: {\n  'skuSttrList':{\n      handler (newSkuList,oldSkuList) {\n        let table = [];\n        this.headData = [];\n        if (newSkuList && !newSkuList.length) {\n          this.newtableList = [];\n        }\n        if (!oldSkuList || (oldSkuList && !oldSkuList.length))return;\n        oldSkuList.forEach((item,index)=>{\n          table.push(item.value);\n          item.key && this.headData.push({k:`define-${index}`,n:item.key});\n        })\n        this.headData.push(...this.exthead)\n        let newtable = ( table.length && UTILS.createTable(table) ) || [];\n        if (newtable.length) {\n          let ev = [0,0];\n           let new_t = newtable.map(i =>(i = [...(i.reverse()),...ev]))\n           this.newtableList = [];\n           new_t.forEach((current,index)=>{\n             let value = [];\n             this.headData.forEach((item,idx)=>{\n               value.push({\n                 n:item.n, //名称\n                 k:item.k, //属性名\n                 v:current[idx] //属性值\n               })\n             })\n             // 属性值存在时进行更新\n             this.$set(this.newtableList,index,value);\n           })\n        }\n        if (this.product_id) {\n          this.updateSkuList();\n        }\n      },\n      deep: true    //深度监听\n    }\n  },\n  created () {\n    this.init();\n  },\n  methods: {\n    /*初始化页面*/\n    init () {\n      this.getCategorys();\n      let promiseque = [this.getCategorys()];\n      if (this.product_id) {\n        promiseque.push(this.getProductDetails())\n      }\n      let loading = this.$loading();\n      Promise.all(promiseque).then(res=>{\n        loading.close();\n        if (res.length >=2) {\n          this.resetDetailData(res);\n        }\n      }).catch(()=>{\n        loading.close();\n      });\n    },\n    /*更新sku规格列表*/\n    updateSkuList () {\n      let skus = this.details.skus;\n      if (!this.newtableList.length)return;\n      this.newtableList.forEach(item=>{\n        let key = '';\n        for (let i=0;i<item.length;i++) {\n          if ((item.length-1) -i>1) {\n            key += item[i].v;\n            continue;\n          }\n          if (key=='') return;\n          let currentSkuItem  = skus[key];\n          if (item[i].k==\"num\" && currentSkuItem && currentSkuItem.num){\n            item[i].v = currentSkuItem.num;\n          }\n          if (item[i].k==\"price\" && currentSkuItem && currentSkuItem.price){\n            item[i].v = currentSkuItem.price;\n          }\n        }\n      })\n    },\n    uploadsuccess (res) {\n      if (res.data.file) {\n        this.products_image = res.data.file;\n      }\n      console.log(res);\n    },\n    /*处理详情数据*/\n    resetDetailData ([categorys,details]) {\n      this.details = details;\n      this.products_name = details.title;\n      this.products_desc = details.desc;\n      this.products_image = details.img;\n      this.category_id = details.category_id;\n      this.products_unit = details.product_unit;\n      this.cats_name = categorys.filter(item=>(item.category_id == details.category_id))[0].category_name;\n      Object.values(details.skusMap).length && Object.values(details.skusMap).forEach(item=>{\n          this.skuSttrList.push({\n            key:item.name,\n            value:item.skuSpecValueList.map(item=>(item.value))\n          })\n      })\n    },\n    /*获取分类*/\n    getCategorys () {\n      return new Promise((resolve,reject)=>{\n        let data = {\n          store_id:this.userinfo.store_id || this.userinfo.store_info[0]['_id']\n        }\n        this.$store.dispatch('product_category/GET_CATEGORYS',data)\n        .then(res=>{\n          resolve(res);\n        })\n        .catch(()=>{\n          reject();\n        })\n      })\n    },\n    /*获取商品详情*/\n    getProductDetails () {\n      return new Promise((resolve,reject)=>{\n        let data = {\n          product_id:this.product_id\n        }\n        this.$store.dispatch('product/GET_PRODUCT_DETAILS',data)\n        .then(res=>{\n          resolve(res);\n        })\n        .catch(()=>{\n          reject();\n        })\n      });\n    },\n    /*设置sku*/\n    setSku () {\n      if (this.skuSttrList.length >= 3)return\n      this.skuSttrList.push({key:'',  value:['']});\n    },\n    /*设置sku 属性值*/\n    setAttrValue (idx) {\n      if (this.skuSttrList[idx]['key']==''){\n        return this.$message.error('请填写属性名')\n      }\n      this.$set(this.skuSttrList[idx]['value'],this.skuSttrList[idx]['value'].length,'');\n    },\n    /*删除属性值*/\n    delSkuRowVal(p_index,c_index){\n      this.skuSttrList[p_index]['value'].splice(c_index,1);\n      this.$set(this.skuSttrList,p_index,this.skuSttrList[p_index]);\n    },\n    /*删除sku 规格行*/\n    delSkuRow (idx) {\n      this.skuSttrList.splice(idx,1);\n    },\n    // 计算sku item宽度\n    compuWidth(item) {\n      return `width:calc( 100%  / ${ item.length } )`\n    },\n    selectcates (e) {\n      this.category_id = e;\n    },\n    /*验证规格值是都为空*/\n    checkSkuValue () {\n      let flag = true;\n      console.log(this.newtableList,'this.newtableList')\n      this.newtableList.forEach(item=>{\n          item.forEach(currentItem=>{\n              if (flag && currentItem.k==\"num\" && (currentItem.v=='' || currentItem.v<=0)) {\n                flag = 'sku库存不能为空或小于0';\n              }\n              if (currentItem.k==\"price\" && (currentItem.v=='' || currentItem.v<=0)) {\n                flag = 'sku价格不能为空或小于0';\n              }\n          })\n      })\n      return flag;\n    },\n    checkSkuReg (c_index,r_index,value) {\n      console.log(c_index,r_index,value);\n    },\n    // 保存商品信息\n    saveGoodInfo () {\n      if (this.products_name == '') {\n        return this.$message.error('请填写商品名称');\n      }\n      if (this.products_desc == '') {\n        return this.$message.error('请填写商品描述');\n      }\n      // if (this.products_image == '') {\n      //   return this.$message.error('请填写商品主图');\n      // }\n      if (this.products_unit == '') {\n        return this.$message.error('请填写库存单位');\n      }\n      if (!this.newtableList.length) {\n        return this.$message.error('请填写sku');\n      }\n      if (this.category_id == '') {\n        return this.$message.error('请填写商品分类');\n      }\n      if (this.checkSkuValue()!=true) {\n        return this.$message.error(this.checkSkuValue());\n      }\n      let params = {\n        products_name: this.products_name,\n        products_desc: this.products_desc,\n        products_image: this.products_image,\n        store_id: this.userinfo.store_id || this.userinfo.store_info[0]['_id'],\n        attributes: this.skuSttrList,\n        products_unit: this.products_unit,\n        category_id: this.category_id,\n        skus: this.newtableList,\n      };\n      let moduleAction = 'product/CREATE_GOODS';\n      if (this.product_id) {\n        params.product_id = this.product_id;\n        moduleAction = 'product/EDIT_GOODS';\n      }\n       this.$store.dispatch(moduleAction,params).then(()=>{\n         this.$message.success('商品发布成功');\n         this.$router.push({name:'main.container.goods.goodsList'});\n      }).catch((res)=>{\n        console.log(res,'res')\n        this.$message.error('商品发布失败');\n      })\n    }\n  },\n  components: {\n    upLoad\n  }\n}\n</script>\n<style lang=\"scss\">\n  #editgoodList{\n    width: 100%;\n    height: 100%;\n    background-color: #FFF;\n    .form-nav{\n      border-bottom: 1px solid #efefef;\n      font-weight: 500;\n      margin:10px;\n      padding:10px;\n      box-sizing: border-box;\n    }\n    .form-item{\n      padding:15px 15px 15px 25px;\n      align-items: center;\n      .demo-input-suffix{\n        font-size: 13px;\n\n      }\n      .cates-tps{\n        color: #38f;\n        font-size: 10px;\n        padding-left: 5px;\n        cursor: pointer;\n      }\n      .el-input{\n        input{\n          border-radius: 0;\n        }\n      }\n      .sku-set-main{\n        width: 400px;\n        min-height: 50px;\n        padding:0 0 0 20px;\n        line-height: 50px;\n        box-sizing: border-box;\n        border:1px solid #efefef;\n        .el-input{\n          input{\n            width: 100px;\n            cursor: pointer;\n            text-align: center;\n          }\n        }\n        .set-row{\n          width: 80%;\n          flex-direction: column;\n          align-items: flex-start;\n          border:1px solid  #efefef;\n          margin:10px;\n          padding:10px;\n          .icon{\n            right: -7px;\n            line-height: 1;\n            top:-7px;\n            cursor: pointer;\n          }\n          .el-input{\n            width: 70px;\n            input{\n              width: 70px;\n            }\n          }\n          .attr-n-line{\n            width: 100%;\n            border-bottom: 1px solid #efefef;\n            margin:10px 0;\n          }\n           .attr-value-main{\n             line-height: 1;\n             align-items: center;\n             flex-wrap: wrap;\n             div{\n               margin:3px 3px 3px 0;\n               .del-icon{\n                 top: -5px;\n                 right: -1px;\n               }\n             }\n             .el-input{\n               input{\n                 width: 70px;\n               }\n             }\n           }\n        }\n      }\n      .sku-table-main{\n        width: 600px;\n        border:1px solid #efefef;\n        .sku-table-header{\n          height: 30px;\n          align-items: center;\n          justify-content: space-around;\n          background-color: #efefef;\n          font-size: 14px;\n          padding:0 5px;\n          line-height: 40px;\n          .sku-t-th{\n            line-height: 1;\n          }\n        }\n        .sku-table-body{\n          padding:0 5px;\n          height: 40px;\n          align-items: center;\n          justify-content: space-around;\n          border:1px solid #efefef;\n          .sku-t-td{\n            flex:1;\n            text-align: center;\n            height: 25px;\n            font-size: 13px;\n            border-right: 1px solid #efefef;\n            &:last-child{\n                border-right:none;\n            }\n            .el-input{\n              height: 25px;\n              input{\n                border-radius: 0;\n                height: 25px;\n                text-align: center;\n                width: 100px!important;\n              }\n            }\n          }\n        }\n      }\n    }\n    .btn-save{\n      margin:10px auto;\n\n    }\n  }\n</style>\n"],"sourceRoot":"src/views/Containers/goods"}]}