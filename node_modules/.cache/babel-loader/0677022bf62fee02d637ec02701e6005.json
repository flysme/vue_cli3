{"remainingRequest":"/Users/moge/dafei/study_project/Vue/saas/node_modules/thread-loader/dist/cjs.js!/Users/moge/dafei/study_project/Vue/saas/node_modules/babel-loader/lib/index.js!/Users/moge/dafei/study_project/Vue/saas/node_modules/cache-loader/dist/cjs.js??ref--0-0!/Users/moge/dafei/study_project/Vue/saas/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/moge/dafei/study_project/Vue/saas/src/views/Containers/store_setting.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/moge/dafei/study_project/Vue/saas/src/views/Containers/store_setting.vue","mtime":1552371582174},{"path":"/Users/moge/dafei/study_project/Vue/saas/node_modules/cache-loader/dist/cjs.js","mtime":1538991184695},{"path":"/Users/moge/dafei/study_project/Vue/saas/node_modules/thread-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/moge/dafei/study_project/Vue/saas/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/moge/dafei/study_project/Vue/saas/node_modules/cache-loader/dist/cjs.js","mtime":1538991184695},{"path":"/Users/moge/dafei/study_project/Vue/saas/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.number.constructor\";\nimport _objectSpread from \"/Users/moge/dafei/study_project/Vue/saas/node_modules/@babel/runtime/helpers/builtin/es6/objectSpread\";\nimport \"core-js/modules/es6.array.iterator\";\nimport \"core-js/modules/es6.promise\";\nimport \"core-js/modules/es7.promise.finally\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport UTILS from '@/utils/utils';\nimport { mapState } from 'vuex';\nexport default {\n  name: 'store-setting',\n  data: function data() {\n    return {\n      userinfo: UTILS.storage.get('userinfo'),\n      business_start_times: '',\n      business_end_times: '',\n      delivery_price: '',\n      mini_delivery_price: '',\n      discount_price: '',\n      buy_price: '',\n      discountList: [],\n      isEdit: false,\n      isbusiness: 0,\n      Loading: false\n    };\n  },\n  computed: _objectSpread({\n    cansaved: function cansaved() {\n      return this.delivery_price != '' && this.delivery_price > 0 && this.mini_delivery_price != '' && this.mini_delivery_price > 0 && this.business_start_times != '' && this.business_start_times && this.business_end_times != '' && this.business_end_times;\n    }\n  }, mapState('login', {\n    storeStatus: function storeStatus(state) {\n      return state.storeStatus;\n    }\n  })),\n  created: function created() {\n    this.initLoadSettingInfo();\n  },\n  methods: {\n    initLoadSettingInfo: function initLoadSettingInfo() {\n      var _this = this;\n\n      var loading = this.$loading();\n      this.$store.dispatch('store_setting/LOAD_STORESETTING', {\n        store_id: this.userinfo.store_id || this.userinfo.store_info[0]['_id']\n      }).then(function (res) {\n        _this.isEdit = res.delivery_price && res.start_delivery_price;\n        _this.delivery_price = res.delivery_price;\n        _this.mini_delivery_price = res.start_delivery_price;\n        _this.business_start_times = res.business_start_times;\n        _this.business_end_times = res.business_end_times;\n        _this.isbusiness = !res.business_status; // this.discountList = res.discounts || [];\n      }).finally(function () {\n        loading.close();\n      });\n    },\n    saveDiscounts: function saveDiscounts() {\n      var buy_price = +this.buy_price;\n      var discount_price = +this.discount_price;\n\n      if (discount_price == '' || discount_price < 0) {\n        return this.$message.error('优惠金额待确认');\n      }\n\n      if (buy_price == '' | buy_price < 0) {\n        return this.$message.error('购买金额待确认');\n      }\n\n      if (Number(discount_price) > Number(buy_price)) {\n        return this.$message.error('优惠金额不能大于购买金额');\n      }\n\n      this.buy_price = '';\n      this.discount_price = ''; // this.discountList.push({buy_price,discount_price})\n    },\n\n    /*删除优惠项*/\n    deleteCurrentDiscount: function deleteCurrentDiscount(index) {\n      this.discountList.splice(index, 1);\n    },\n    save: function save() {\n      var _this2 = this;\n\n      var data = {\n        store_id: this.userinfo.store_id || this.userinfo.store_info[0]['_id'],\n        delivery_price: this.delivery_price,\n        start_delivery_price: this.mini_delivery_price,\n        // discounts:this.discountList || '',\n        business_start_times: this.business_start_times,\n        business_end_times: this.business_end_times,\n        business_status: Number(!this.isbusiness)\n      };\n      this.Loading = true;\n      this.$store.dispatch('store_setting/SET_SETOREBUSINESS', data).then(function (res) {\n        _this2.$message({\n          message: '保存成功',\n          center: true\n        });\n      }).finally(function () {\n        _this2.initLoadSettingInfo();\n\n        _this2.Loading = false;\n      });\n    },\n    updateSetting: function updateSetting() {\n      var _this3 = this;\n\n      if (this.timer) clearTimeout(this.timer);\n      this.Loading = true;\n      this.timer = setTimeout(function () {\n        var data = {\n          setting_id: _this3.$store.state.store_setting.settingInfo.setting_id,\n          store_id: _this3.userinfo.store_id || _this3.userinfo.store_info[0]['_id'],\n          delivery_price: _this3.delivery_price,\n          start_delivery_price: _this3.mini_delivery_price,\n          // discounts:this.discountList || '',\n          business_start_times: _this3.business_start_times,\n          business_end_times: _this3.business_end_times,\n          business_status: Number(!_this3.isbusiness)\n        };\n\n        _this3.$store.dispatch('store_setting/UPDATE_SETOREBUSINESS', data).then(function (res) {\n          _this3.$message({\n            message: '更新成功',\n            center: true\n          });\n        }).finally(function () {\n          _this3.initLoadSettingInfo();\n\n          _this3.Loading = false;\n        });\n      }, 1000);\n    }\n  }\n};",{"version":3,"sources":["store_setting.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"store-setting\">\n    <el-row>\n      <div class=\"sys-flex form-item\">\n        <el-col :span=\"3\">\n          <div class=\"demo-input-suffix\">\n            配送费设置(元):\n          </div>\n        </el-col>\n        <el-col :span=\"4\">\n          <el-input\n            type=\"number\"\n            size=\"mini\"\n            :disabled=\"!storeStatus.canhandle\"\n            placeholder=\"请输入配送金额\"\n            v-model=\"delivery_price\">\n          </el-input>\n        </el-col>\n      </div>\n    </el-row>\n    <el-row>\n      <div class=\"sys-flex form-item\">\n        <el-col :span=\"3\">\n          <div class=\"demo-input-suffix\">\n            起送金额设置(元):\n          </div>\n        </el-col>\n        <el-col :span=\"4\">\n          <el-input\n            type=\"number\"\n            size=\"mini\"\n            :disabled=\"!storeStatus.canhandle\"\n            placeholder=\"请输入起送金额\"\n            v-model=\"mini_delivery_price\">\n          </el-input>\n        </el-col>\n      </div>\n    </el-row>\n    <!-- <el-row>\n      <div class=\"sys-flex form-item\">\n        <el-col :span=\"3\">\n          <div class=\"demo-input-suffix\">\n            满减设置:\n          </div>\n        </el-col>\n        <el-col :span=\"4\">\n          <div class=\"discounts-box\">\n              <div class=\"create-t-discount sys-flex\">\n                <el-input\n                  size=\"mini\"\n                  type=\"number\"\n                  placeholder=\"购买金额\"\n                  min=\"1\"\n                  :disabled=\"!storeStatus.canhandle\"\n                  v-model=\"buy_price\">\n                </el-input>\n                <el-input\n                  size=\"mini\"\n                  type=\"number\"\n                  min=\"1\"\n                  :disabled=\"!storeStatus.canhandle\"\n                  placeholder=\"优惠金额\"\n                  v-model=\"discount_price\">\n                </el-input>\n                <el-button type=\"primary\" :disabled=\"!storeStatus.canhandle\"  size=\"mini\" @click=\"saveDiscounts\">保存</el-button>\n              </div>\n              <div class=\"discount-box-list flex-wrap sys-flex\">\n                  <div class=\"discount-item f-6 rel\" v-for=\"(item,index) in discountList\" :key=\"index\">\n                      满{{item.buy_price}}减{{item.discount_price}}\n                      <div class=\"discount-shade abs\" @click.stop=\"deleteCurrentDiscount(index)\">删除</div>\n                  </div>\n              </div>\n          </div>\n        </el-col>\n\n      </div>\n    </el-row> -->\n    <el-row>\n      <div class=\"sys-flex form-item\">\n        <el-col :span=\"3\">\n          <div class=\"demo-input-suffix\">\n            营业时间:\n          </div>\n        </el-col>\n        <el-col :span=\"10\" class=\"sys-flex align-center\">\n          <el-time-select\n           placeholder=\"起始时间\"\n           :disabled=\"!storeStatus.canhandle\"\n           v-model=\"business_start_times\"\n           :picker-options=\"{\n             start: '05:30',\n             step: '00:15',\n             end: '23:30'\n           }\">\n         </el-time-select>\n         <span>&nbsp;-&nbsp;</span>\n         <el-time-select\n           placeholder=\"结束时间\"\n           :disabled=\"!storeStatus.canhandle\"\n           v-model=\"business_end_times\"\n           :picker-options=\"{\n             start: '05:30',\n             step: '00:15',\n             end: '23:30',\n             minTime: business_start_times\n           }\">\n         </el-time-select>\n        </el-col>\n      </div>\n    </el-row>\n    <el-row>\n      <div class=\"sys-flex form-item\">\n        <el-col :span=\"3\">\n          <div class=\"demo-input-suffix\">\n            是否打烊:\n          </div>\n        </el-col>\n        <el-col :span=\"10\" class=\"sys-flex align-center\">\n          <el-switch\n            style=\"display: block\"\n            v-model=\"isbusiness\"\n            active-color=\"#13ce66\"\n            >\n          </el-switch>\n        </el-col>\n      </div>\n    </el-row>\n    <el-row>\n      <div class=\"submit-btn\">\n        <el-col>\n          <el-button type=\"primary\" v-if=\"!isEdit\" :disabled=\"!cansaved || !storeStatus.canhandle\" :loading=\"Loading\"  size=\"mini\" @click=\"save\">保存</el-button>\n          <el-button type=\"primary\" v-else :disabled=\"!cansaved || !storeStatus.canhandle\" :loading=\"Loading\"  size=\"mini\" @click=\"updateSetting\">更新</el-button>\n        </el-col>\n      </div>\n    </el-row>\n  </div>\n</template>\n<script>\nimport UTILS from '@/utils/utils'\nimport { mapState } from 'vuex'\nexport default {\n  name: 'store-setting',\n  data (){\n    return {\n      userinfo:UTILS.storage.get('userinfo'),\n      business_start_times:'',\n      business_end_times:'',\n      delivery_price:'',\n      mini_delivery_price:'',\n      discount_price:'',\n      buy_price:'',\n      discountList:[],\n      isEdit:false,\n      isbusiness:0,\n      Loading:false\n    }\n  },\n  computed:{\n    cansaved () {\n      return (\n        (this.delivery_price!='' && this.delivery_price>0)\n        && (this.mini_delivery_price!='' && this.mini_delivery_price>0)\n        && (this.business_start_times!='' && this.business_start_times && this.business_end_times!='' && this.business_end_times)\n      )\n    },\n    ...mapState('login',{\n        storeStatus:state => state.storeStatus,\n    })\n  },\n  created () {\n    this.initLoadSettingInfo();\n  },\n  methods:{\n    initLoadSettingInfo () {\n      let loading = this.$loading();\n      this.$store.dispatch('store_setting/LOAD_STORESETTING',{store_id:this.userinfo.store_id || this.userinfo.store_info[0]['_id']}).then(res=>{\n          this.isEdit  = res.delivery_price && res.start_delivery_price;\n          this.delivery_price = res.delivery_price;\n          this.mini_delivery_price = res.start_delivery_price;\n          this.business_start_times = res.business_start_times;\n          this.business_end_times = res.business_end_times;\n          this.isbusiness = !res.business_status;\n          // this.discountList = res.discounts || [];\n      }).finally(()=>{\n        loading.close();\n      })\n    },\n    saveDiscounts () {\n      let buy_price = +this.buy_price;\n      let discount_price = +this.discount_price;\n      if (discount_price=='' || discount_price<0) {\n        return this.$message.error('优惠金额待确认');\n      }\n      if (buy_price=='' | buy_price<0) {\n        return this.$message.error('购买金额待确认');\n      }\n      if (Number(discount_price) > Number(buy_price)) {\n        return  this.$message.error('优惠金额不能大于购买金额');\n      }\n      this.buy_price = '';\n      this.discount_price = '';\n      // this.discountList.push({buy_price,discount_price})\n    },\n    /*删除优惠项*/\n    deleteCurrentDiscount (index) {\n      this.discountList.splice(index,1);\n    },\n    save () {\n      let data = {\n        store_id:this.userinfo.store_id || this.userinfo.store_info[0]['_id'],\n        delivery_price:this.delivery_price,\n        start_delivery_price:this.mini_delivery_price,\n        // discounts:this.discountList || '',\n        business_start_times:this.business_start_times,\n        business_end_times:this.business_end_times,\n        business_status:Number(!this.isbusiness),\n      }\n      this.Loading = true;\n      this.$store.dispatch('store_setting/SET_SETOREBUSINESS',data).then(res=>{\n        this.$message({message: '保存成功',center: true});\n      }).finally(()=>{\n          this.initLoadSettingInfo();\n          this.Loading = false;\n      });\n    },\n    updateSetting () {\n      if (this.timer)clearTimeout(this.timer)\n      this.Loading = true;\n      this.timer = setTimeout(()=>{\n        let data = {\n          setting_id:this.$store.state.store_setting.settingInfo.setting_id,\n          store_id:this.userinfo.store_id || this.userinfo.store_info[0]['_id'],\n          delivery_price:this.delivery_price,\n          start_delivery_price:this.mini_delivery_price,\n          // discounts:this.discountList || '',\n          business_start_times:this.business_start_times,\n          business_end_times:this.business_end_times,\n          business_status:Number(!this.isbusiness),\n        }\n        this.$store.dispatch('store_setting/UPDATE_SETOREBUSINESS',data).then(res=>{\n          this.$message({message: '更新成功',center: true});\n        }).finally(()=>{\n            this.initLoadSettingInfo();\n            this.Loading = false;\n        });\n      },1000)\n    }\n  }\n}\n</script>\n<style lang=\"scss\" scoped>\n  .store-setting{\n    background-color: #fff;\n    .form-item{\n      padding:15px 15px 15px 25px;\n      align-items: center;\n      .demo-input-suffix{\n        font-size: 13px;\n      }\n      .cates-tps{\n        color: #38f;\n        font-size: 10px;\n        padding-left: 5px;\n        cursor: pointer;\n      }\n      .el-input__inner{\n        height: 18px!important;\n        padding:0 10px;\n        border-radius: 0;\n      }\n      .discounts-box{\n        width: 270px;\n        min-height: 50px;\n        padding:20px;\n        justify-content: space-between;\n        border: 1px solid #efefef;\n        .create-t-discount{\n          border-bottom: 1px solid #efefef;\n          padding-bottom:10px;\n          .el-input{\n            margin-right: 10px!important;\n          }\n        }\n        .discount-item{\n          width: fit-content;\n          height: 25px;\n          line-height: 25px;\n          margin:5px;\n          padding:2px 5px;\n          border:1px solid #efefef;\n          cursor: pointer;\n          color: red;\n          .discount-shade{\n             opacity: 0;\n             transition: 0.3s;\n             width:100%;\n             height: 29px;\n             line-height: 29px;\n             background-color: rgba(0,0,0,0.6);\n             top: 0;\n             left: 0;\n             color:#fff;\n          }\n        }\n        .discount-item:hover .discount-shade{\n            opacity: 1;\n        }\n      }\n    }\n    .submit-btn{\n      padding:40px;\n    }\n  }\n\n</style>\n"],"sourceRoot":"src/views/Containers"}]}